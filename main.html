<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRISM | Payment Risk & Integrity Surveillance Module</title>
    
    <!-- Fonts: Plus Jakarta Sans (Matches reference) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <style>
        /* ==========================
           DESIGN SYSTEM (Strict Adherence)
        ========================== */
        :root {
            /* Palette */
            --bg-color: #dbe0e8;
            --card-bg: #ffffff;
            --text-primary: #1a1e23;
            --text-secondary: #8c909c;
            --accent-orange: #eb5e28; /* Brand Color */
            --accent-blue: #5a81fa;
            --accent-dark: #252b42; 
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            
            /* UI Tokens */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 8px;
            --shadow-soft: 0 12px 30px rgba(0, 0, 0, 0.05);
            --shadow-float: 0 8px 20px rgba(0, 0, 0, 0.1);
            --font-main: 'Plus Jakarta Sans', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Common Components */
        .btn {
            border: none; cursor: pointer; font-family: var(--font-main);
            font-weight: 600; transition: transform 0.1s;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary {
            background: var(--accent-dark); color: white;
            padding: 14px 28px; border-radius: 30px;
        }
        .btn-danger {
            background: var(--danger); color: white;
            padding: 12px 24px; border-radius: 30px;
        }
        .btn-ghost { background: transparent; color: var(--text-secondary); transition: 0.2s; }
        .btn-ghost:hover { color: var(--text-primary); background: #f4f6f9; border-radius: 8px;}
        
        .card {
            background: var(--card-bg); border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft); padding: 24px;
        }

        .badge {
            padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700;
        }
        .badge-safe { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-risk { background: #fee2e2; color: #991b1b; }
        .badge-neutral { background: #f3f4f6; color: #4b5563; }

        /* ==========================
           TOOLTIP SYSTEM
        ========================== */
        [data-tooltip] { position: relative; }
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            background: var(--accent-dark);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            pointer-events: none;
            opacity: 0;
            animation: tooltipIn 0.2s forwards;
            font-weight: 500;
        }
        
        /* Default: Top */
        [data-tooltip]:not([data-tooltip-pos="right"]):hover::after {
            bottom: 100%; left: 50%; transform: translateX(-50%);
            margin-bottom: 8px;
        }

        /* Right Position (Sidebar) */
        [data-tooltip-pos="right"]:hover::after {
            left: 100%; top: 50%; transform: translateY(-50%);
            margin-left: 12px;
        }

        @keyframes tooltipIn { to { opacity: 1; } }


        /* View Management */
        .view-section { display: none; width: 100%; height: 100%; }
        .view-section.active { display: flex; }

        /* ==========================
           VIEW 1: AUTHENTICATION
        ========================== */
        #auth-view {
            align-items: center;
            justify-content: center;
        }
        .auth-container {
            width: 100%; max-width: 400px; text-align: center;
        }
        .logo-box {
            width: 50px; height: 50px; background: var(--accent-orange);
            border-radius: 12px; margin: 0 auto 20px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 1.5rem; transform: rotate(45deg);
        }
        .logo-box ion-icon { transform: rotate(-45deg); }
        
        .input-field {
            width: 100%; padding: 16px; margin-bottom: 16px;
            border: 1px solid #eee; border-radius: var(--radius-md);
            background: #f8f9fc; font-family: var(--font-main); outline: none;
        }
        .input-field:focus { border-color: var(--accent-blue); background: white; }

        /* ==========================
           VIEW 2: MOBILE APP (User)
        ========================== */
        #mobile-view {
            background: var(--bg-color);
            align-items: center; justify-content: center;
        }
        .phone-frame {
            width: 100%; max-width: 390px; height: 95vh; max-height: 844px;
            background: #f4f6f9; border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden; position: relative;
            display: flex; flex-direction: column;
        }
        
        /* Mobile Content Switcher */
        .m-content { display: none; flex-direction: column; height: 100%; }
        .m-content.active { display: flex; }

        /* Mobile Header */
        .m-header {
            padding: 20px 24px; background: white;
            display: flex; justify-content: space-between; align-items: center;
        }
        .user-info-area {
            cursor: pointer; transition: opacity 0.2s;
        }
        .user-info-area:active { opacity: 0.6; }
        
        /* Balance Card */
        .m-balance {
            margin: 20px; padding: 24px;
            background: var(--text-primary); color: white;
            border-radius: var(--radius-lg); position: relative; overflow: hidden;
            cursor: pointer; transition: transform 0.2s;
        }
        .m-balance:active { transform: scale(0.98); }
        .m-balance h2 { font-size: 2rem; margin: 5px 0 0 0; }
        .m-balance small { opacity: 0.7; }
        
        /* Quick Actions */
        .m-actions {
            display: flex; justify-content: space-evenly; margin-bottom: 20px;
        }
        .action-btn {
            display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 0.8rem; cursor: pointer;
        }
        .action-icon {
            width: 48px; height: 48px; background: white; border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            color: var(--accent-orange); font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.2s;
        }
        .action-icon:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }

        /* Lists */
        .section-title {
            padding: 0 24px; margin-bottom: 12px;
            font-weight: 700; font-size: 0.95rem; color: var(--text-primary);
        }
        
        .recent-scroll {
            display: flex; gap: 16px; overflow-x: auto; padding: 0 24px 20px;
            scrollbar-width: none;
        }
        .recent-item {
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            min-width: 60px; cursor: pointer;
        }
        .avatar {
            width: 50px; height: 50px; border-radius: 50%; background: #ddd;
            background-size: cover; border: 2px solid white;
        }

        .contact-list {
            padding: 0 24px; overflow-y: auto; flex: 1;
        }
        .contact-row {
            display: flex; align-items: center; gap: 16px; padding: 12px 0;
            border-bottom: 1px solid #eee; cursor: pointer;
        }
        .contact-info h4 { font-size: 0.95rem; }
        .contact-info p { font-size: 0.8rem; color: var(--text-secondary); }

        /* Sub-Pages (QR, Self, History) */
        .sub-page-header {
            padding: 20px; background: white; display: flex; align-items: center; gap: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        .sub-page-body {
            padding: 20px; flex: 1; overflow-y: auto; display: flex; flex-direction: column; align-items: center;
        }

        /* Payment Modal (Overlay) */
        .payment-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 50;
            display: none; flex-direction: column; padding: 24px;
        }
        .payment-overlay.active { display: flex; }
        
        .pay-input-container {
            flex: 1; display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
        }
        .pay-amount {
            font-size: 3rem; font-weight: 800; border: none; text-align: center;
            color: var(--text-primary); outline: none; width: 100%;
        }

        /* Shared Bottom Sheet Modal Style (Risk, Balance, Profile) */
        .bottom-modal {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: white; border-top-left-radius: 24px; border-top-right-radius: 24px;
            padding: 30px; box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
            transform: translateY(100%); transition: transform 0.3s; z-index: 60;
        }
        .bottom-modal.show { transform: translateY(0); }
        
        .modal-icon { 
            width: 60px; height: 60px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; margin: 0 auto 16px;
        }
        .icon-risk { background: #fff7ed; color: var(--warning); }
        .icon-error { background: #fef2f2; color: var(--danger); }
        .icon-profile { background: #eff6ff; color: var(--accent-blue); }

        /* Profile Modal Specifics */
        .profile-row {
            display: flex; justify-content: space-between; width: 100%;
            padding: 12px 0; border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
        }
        .profile-label { color: var(--text-secondary); }
        .profile-val { font-weight: 600; color: var(--text-primary); }

        /* Success Screen */
        .success-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--success); color: white;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 70;
        }
        .success-screen.active { display: flex; }

        /* ==========================
           VIEW 3: DESKTOP DASHBOARD (Admin)
        ========================== */
        #desktop-view {
            padding: 20px; gap: 20px;
        }
        .sidebar {
            width: 80px; background: var(--card-bg); border-radius: var(--radius-lg);
            display: flex; flex-direction: column; align-items: center; padding: 30px 0;
            gap: 24px; height: 100%; box-shadow: var(--shadow-soft);
        }
        .nav-icon {
            font-size: 1.5rem; color: var(--text-secondary); cursor: pointer;
            padding: 10px; border-radius: 12px; transition: 0.2s; position: relative;
        }
        .nav-icon.active { background: var(--accent-dark); color: white; }
        .nav-icon:hover:not(.active) { background: #f4f6f9; color: var(--text-primary); }

        .dashboard-main { flex: 1; display: flex; flex-direction: column; gap: 24px; height: 100%; overflow: hidden; }

        /* Desktop Tabs */
        .d-tab-content { display: none; flex-direction: column; height: 100%; gap: 24px;}
        .d-tab-content.active { display: flex; }

        /* Top Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .stat-card {
            background: white; padding: 20px; border-radius: var(--radius-md);
            box-shadow: var(--shadow-soft); display: flex; flex-direction: column; justify-content: center;
            transition: transform 0.2s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-val { font-size: 1.8rem; font-weight: 700; color: var(--text-primary); }
        .stat-label { font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px; }

        /* Content Grid */
        .content-split { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; flex: 1; overflow: hidden; }
        
        .live-feed-card {
            background: white; border-radius: var(--radius-lg); padding: 24px;
            display: flex; flex-direction: column; overflow: hidden; box-shadow: var(--shadow-soft);
        }
        .table-header {
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; padding-bottom: 12px;
            border-bottom: 1px solid #eee; font-size: 0.85rem; color: var(--text-secondary); font-weight: 600;
        }
        .feed-scroll { overflow-y: auto; flex: 1; }
        .feed-row {
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; padding: 16px 0;
            border-bottom: 1px solid #f9f9f9; font-size: 0.9rem; align-items: center;
            cursor: pointer; transition: background 0.1s;
        }
        .feed-row:hover { background: #f8f9fc; }

        .risk-map-card {
            background: white; border-radius: var(--radius-lg); padding: 24px;
            box-shadow: var(--shadow-soft); display: flex; flex-direction: column;
        }
        .region-list { margin-top: 20px; display: flex; flex-direction: column; gap: 12px; }
        .region-bar { display: flex; align-items: center; justify-content: space-between; font-size: 0.9rem; }
        .progress-bg { flex: 1; height: 6px; background: #eee; border-radius: 3px; margin: 0 12px; }
        .progress-fill { height: 100%; border-radius: 3px; background: var(--accent-orange); }

        /* Admin Detail Modal (Centered Overlay) */
        .admin-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); backdrop-filter: blur(4px);
            z-index: 100; display: none; align-items: center; justify-content: center;
        }
        .admin-modal-overlay.active { display: flex; }
        .detail-box {
            background: white; padding: 30px; border-radius: var(--radius-lg);
            width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }
        .detail-row {
            display: flex; justify-content: space-between; margin-bottom: 12px;
            font-size: 0.9rem; border-bottom: 1px solid #eee; padding-bottom: 8px;
        }
        .detail-label { color: var(--text-secondary); }
        .detail-val { font-weight: 600; }

    </style>
</head>
<body>

    <!-- ==========================
         VIEW 1: SHARED LOGIN
    ========================== -->
    <section id="auth-view" class="view-section active">
        <div class="auth-container card">
            <div class="logo-box"><ion-icon name="prism"></ion-icon></div>
            <h2>PRISM Secure Login</h2>
            <p style="color:var(--text-secondary); margin-bottom: 30px;">Payment Risk & Integrity Surveillance Module</p>
            
            <form onsubmit="handleLogin(event)">
                <input type="email" id="emailInput" class="input-field" placeholder="Email Address" required>
                <input type="password" class="input-field" placeholder="Password" value="123456">
                <button type="submit" class="btn btn-primary" style="width: 100%" data-tooltip="Enter the system">Sign In</button>
            </form>
            
            <div style="margin-top: 20px; font-size: 0.8rem; text-align: left; background: #f4f6f9; padding: 15px; border-radius: 12px;">
                <strong>Demo Credentials:</strong><br>
                User: <span style="font-family:monospace">user@test.com</span> (Mobile App)<br>
                Admin: <span style="font-family:monospace">admin@prism.com</span> (Dashboard)
            </div>
        </div>
    </section>

    <!-- ==========================
         VIEW 2: MOBILE INTERFACE
    ========================== -->
    <section id="mobile-view" class="view-section">
        <div class="phone-frame">
            
            <!-- Mobile Home Tab -->
            <div id="m-home" class="m-content active">
                <div class="m-header">
                    <div class="user-info-area" onclick="openProfileModal()" data-tooltip="View Profile">
                        <small style="color:var(--text-secondary)">Hello,</small>
                        <h3 id="user-name">Rahul Sharma</h3>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="avatar" style="background-image: url('https://i.pravatar.cc/150?img=12')" onclick="openProfileModal()"></div>
                        <button class="btn-ghost" onclick="handleLogout()" title="Log Out" style="padding: 8px;" data-tooltip="Sign out">
                            <ion-icon name="log-out-outline" style="font-size: 1.6rem;"></ion-icon>
                        </button>
                    </div>
                </div>

                <div class="m-balance" onclick="switchMobileContent('m-history')" data-tooltip="View Transaction History">
                    <small>Available Balance</small>
                    <h2 id="wallet-balance">₹ 24,500</h2>
                    <ion-icon name="wallet-outline" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.2;"></ion-icon>
                </div>

                <div class="m-actions">
                    <div class="action-btn" onclick="switchMobileContent('m-qr')" data-tooltip="Scan QR Code">
                        <div class="action-icon"><ion-icon name="qr-code-outline"></ion-icon></div>
                        <span>Scan QR</span>
                    </div>
                    <div class="action-btn" onclick="switchMobileContent('m-send')" data-tooltip="Send to Contact">
                        <div class="action-icon"><ion-icon name="person-outline"></ion-icon></div>
                        <span>To Contact</span>
                    </div>
                    <div class="action-btn" onclick="switchMobileContent('m-self')" data-tooltip="Self Transfer">
                        <div class="action-icon"><ion-icon name="refresh-outline"></ion-icon></div>
                        <span>Self</span>
                    </div>
                    <div class="action-btn" onclick="switchMobileContent('m-history')" data-tooltip="Check History">
                        <div class="action-icon"><ion-icon name="grid-outline"></ion-icon></div>
                        <span>History</span>
                    </div>
                </div>

                <div class="section-title">Recent Payees</div>
                <div class="recent-scroll" id="recent-list">
                    <!-- Populated by JS -->
                </div>

                <div class="section-title">All Contacts</div>
                <div class="contact-list" id="contact-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Mobile: QR Scan View -->
            <div id="m-qr" class="m-content">
                <div class="sub-page-header">
                    <button class="btn-ghost" onclick="switchMobileContent('m-home')"><ion-icon name="arrow-back" style="font-size: 1.5rem;"></ion-icon></button>
                    <h3>Scan QR Code</h3>
                </div>
                <div style="flex: 1; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;">
                    <div style="width: 250px; height: 250px; border: 4px solid var(--accent-orange); border-radius: 20px; position: relative;">
                        <div style="width: 100%; height: 2px; background: red; position: absolute; top: 0; animation: scan 2s infinite;"></div>
                    </div>
                    <p style="margin-top: 20px; opacity: 0.7;">Align QR code within frame</p>
                    <button class="btn btn-primary" style="margin-top: 30px;" onclick="simulateScan()">Simulate Scan</button>
                </div>
                <style>@keyframes scan { 0% {top: 0;} 50% {top: 100%;} 100% {top: 0;} }</style>
            </div>

            <!-- Mobile: Self Transfer View -->
            <div id="m-self" class="m-content">
                 <div class="sub-page-header">
                    <button class="btn-ghost" onclick="switchMobileContent('m-home')"><ion-icon name="arrow-back" style="font-size: 1.5rem;"></ion-icon></button>
                    <h3>Self Transfer</h3>
                </div>
                <div class="sub-page-body">
                    <div class="card" style="width: 100%; margin-bottom: 20px;">
                        <small style="color: var(--text-secondary)">From</small>
                        <h3>PRISM Savings ...8821</h3>
                        <div style="height: 1px; background: #eee; margin: 10px 0;"></div>
                        <small style="color: var(--text-secondary)">To</small>
                        <h3>PRISM Current ...9001</h3>
                    </div>
                    <input type="number" class="input-field" placeholder="Amount (₹)" style="font-size: 1.2rem; text-align: center;">
                    <button class="btn btn-primary" style="width: 100%;" onclick="alert('Funds Transferred Successfully!')">Transfer Now</button>
                </div>
            </div>

             <!-- Mobile: Send View -->
             <div id="m-send" class="m-content">
                <div class="sub-page-header">
                   <button class="btn-ghost" onclick="switchMobileContent('m-home')"><ion-icon name="arrow-back" style="font-size: 1.5rem;"></ion-icon></button>
                   <h3>Send Money</h3>
               </div>
               <div style="padding: 10px 20px;">
                   <input type="text" class="input-field" placeholder="Search name or number..." style="margin-bottom: 0;">
               </div>
               <div class="contact-list" id="send-contact-list">
                   <!-- Replicated contact list -->
               </div>
           </div>

            <!-- Mobile: History View -->
            <div id="m-history" class="m-content">
                <div class="sub-page-header">
                    <button class="btn-ghost" onclick="switchMobileContent('m-home')"><ion-icon name="arrow-back" style="font-size: 1.5rem;"></ion-icon></button>
                    <h3>Transaction History</h3>
                </div>
                <div class="sub-page-body" style="align-items: stretch;" id="m-hist-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Payment Overlay -->
            <div id="payment-overlay" class="payment-overlay">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <button class="btn-ghost" onclick="closePayment()"><ion-icon name="arrow-back" style="font-size: 1.5rem;"></ion-icon></button>
                    <div>
                        <small>Paying to</small>
                        <h4 id="payee-name">Receiver</h4>
                    </div>
                </div>

                <div class="pay-input-container">
                    <small>Enter Amount</small>
                    <div style="display: flex; align-items: center; justify-content: center;">
                        <span style="font-size: 2rem; font-weight: 700;">₹</span>
                        <input type="number" id="amount-input" class="pay-amount" placeholder="0" oninput="checkBalance()">
                    </div>
                    <small id="bal-hint" style="color: var(--text-secondary); margin-top: 10px;">Available: ₹24,500</small>
                </div>

                <button class="btn btn-primary" style="width: 100%; padding: 18px;" onclick="processPayment()">
                    Proceed to Pay
                </button>
            </div>

            <!-- Risk Warning Modal -->
            <div id="risk-modal" class="bottom-modal">
                <div class="modal-icon icon-risk"><ion-icon name="warning"></ion-icon></div>
                <h3 style="text-align: center; margin-bottom: 10px;">Unusual Activity Detected</h3>
                <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 24px; line-height: 1.5;">
                    PRISM has flagged this transaction pattern as unusual. 
                    Only proceed if you personally trust this receiver.
                </p>
                <button class="btn btn-danger" style="width: 100%; margin-bottom: 12px;" onclick="confirmPay()">Yes, I Trust Them</button>
                <button class="btn btn-ghost" style="width: 100%" onclick="closePayment()">Cancel Transaction</button>
            </div>

            <!-- Insufficient Balance Modal -->
            <div id="balance-error-modal" class="bottom-modal">
                <div class="modal-icon icon-error"><ion-icon name="alert-circle-outline"></ion-icon></div>
                <h3 style="text-align: center; margin-bottom: 10px;">Insufficient Balance</h3>
                <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 24px; line-height: 1.5;">
                    You do not have enough funds in your account to complete this transaction.
                </p>
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 12px;" onclick="closePayment()">Okay, Got it</button>
            </div>

            <!-- User Profile Modal (Mobile - Bottom Sheet) -->
            <div id="profile-modal" class="bottom-modal">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="width: 80px; height: 80px; border-radius: 50%; background-image: url('https://i.pravatar.cc/150?img=12'); background-size: cover; margin: 0 auto 15px; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"></div>
                    <h2 style="margin-bottom: 5px;">Rahul Sharma</h2>
                    <span class="badge badge-safe">KYC Verified</span>
                </div>
                
                <div class="profile-row">
                    <span class="profile-label">PRISM ID</span>
                    <span class="profile-val">rahul@prism</span>
                </div>
                <div class="profile-row">
                    <span class="profile-label">Phone Number</span>
                    <span class="profile-val">+91 98765 43210</span>
                </div>
                <div class="profile-row">
                    <span class="profile-label">Email</span>
                    <span class="profile-val">rahul.sharma@test.com</span>
                </div>
                <div class="profile-row" style="border-bottom: none;">
                    <span class="profile-label">Account Type</span>
                    <span class="profile-val">Savings (Tier 1)</span>
                </div>

                <button class="btn btn-ghost" style="width: 100%; margin-top: 20px;" onclick="closeProfileModal()">Close Profile</button>
            </div>


            <!-- Success Screen -->
            <div id="success-screen" class="success-screen">
                <div style="width: 80px; height: 80px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--success); font-size: 3rem; margin-bottom: 20px;">
                    <ion-icon name="checkmark"></ion-icon>
                </div>
                <h2>Payment Successful</h2>
                <p style="opacity: 0.8; margin-top: 10px;">Transaction ID: <span id="success-tid">#8821</span></p>
                <h1 style="margin-top: 20px;" id="success-amount">₹ 0</h1>
            </div>

        </div>
    </section>

    <!-- ==========================
         VIEW 3: DESKTOP DASHBOARD
    ========================== -->
    <section id="desktop-view" class="view-section">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-box" style="width: 40px; height: 40px; font-size: 1.2rem; margin-bottom: 40px;" data-tooltip-pos="right" data-tooltip="PRISM Admin"><ion-icon name="prism"></ion-icon></div>
            
            <div class="nav-icon active" id="nav-analytics" onclick="switchDesktopTab('d-tab-analytics')" data-tooltip-pos="right" data-tooltip="Analytics Dashboard">
                <ion-icon name="analytics-outline"></ion-icon>
            </div>
            
            <div class="nav-icon" id="nav-users" onclick="switchDesktopTab('d-tab-users')" data-tooltip-pos="right" data-tooltip="User Network">
                <ion-icon name="people-outline"></ion-icon>
            </div>
            
            <div class="nav-icon" id="nav-rules" onclick="switchDesktopTab('d-tab-rules')" data-tooltip-pos="right" data-tooltip="Detection Rules">
                <ion-icon name="shield-checkmark-outline"></ion-icon>
            </div>
            
            <div class="nav-icon" style="margin-top: auto;" onclick="handleLogout()" title="Log Out" data-tooltip-pos="right" data-tooltip="Sign Out">
                <ion-icon name="log-out-outline"></ion-icon>
            </div>
        </div>

        <!-- Main Content -->
        <div class="dashboard-main">
            <!-- Header -->
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>Surveillance Dashboard</h1>
                    <p style="color: var(--text-secondary);">Real-time payment integrity monitoring • <span style="color: var(--success); font-weight: 600;">● System Active</span></p>
                </div>
                <!-- Interactive Admin Avatar -->
                <div class="avatar" style="background-image: url('https://i.pravatar.cc/150?img=68'); width: 40px; height: 40px; cursor: pointer;" onclick="openAdminProfile()" data-tooltip="View Profile"></div>
            </div>

            <!-- Tab 1: Analytics (Default) -->
            <div id="d-tab-analytics" class="d-tab-content active">
                <!-- Top Metrics -->
                <div class="stats-grid">
                    <div class="stat-card" data-tooltip="Total processed volume">
                        <div class="stat-val">₹ 42.5L</div>
                        <div class="stat-label">Total Volume (24h)</div>
                    </div>
                    <div class="stat-card" data-tooltip="Total transaction count">
                        <div class="stat-val">1,204</div>
                        <div class="stat-label">Transactions</div>
                    </div>
                    <div class="stat-card" data-tooltip="Percentage of flagged transactions">
                        <div class="stat-val" style="color: var(--danger);">3.2%</div>
                        <div class="stat-label">Risk Flag Rate</div>
                    </div>
                    <div class="stat-card" data-tooltip="Alerts requiring attention">
                        <div class="stat-val">12</div>
                        <div class="stat-label">Active Alerts</div>
                    </div>
                </div>

                <!-- Split View -->
                <div class="content-split">
                    <!-- Live Feed -->
                    <div class="live-feed-card">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <h3>Live Transaction Feed</h3>
                            <button class="btn-ghost" style="font-size: 0.9rem;" data-tooltip="Filter Risk Levels"><ion-icon name="filter"></ion-icon> Filter</button>
                        </div>
                        <div class="table-header">
                            <span>TXN ID</span>
                            <span>PARTICIPANTS</span>
                            <span>AMOUNT</span>
                            <span>RISK SCORE</span>
                        </div>
                        <div class="feed-scroll" id="admin-feed">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Risk Geo Viz -->
                    <div class="risk-map-card">
                        <h3>Risk Origin Map</h3>
                        <p style="color: var(--text-secondary); font-size: 0.85rem;">Geographic distribution of flagged payments</p>
                        
                        <div style="flex: 1; display: flex; align-items: center; justify-content: center; opacity: 0.1; font-size: 5rem;">
                            <ion-icon name="map"></ion-icon>
                        </div>

                        <div class="region-list">
                            <div class="region-bar">
                                <span style="width: 50px;">North</span>
                                <div class="progress-bg"><div class="progress-fill" style="width: 75%; background: var(--danger);"></div></div>
                                <span style="font-weight: 700;">75%</span>
                            </div>
                            <div class="region-bar">
                                <span style="width: 50px;">West</span>
                                <div class="progress-bg"><div class="progress-fill" style="width: 40%; background: var(--warning);"></div></div>
                                <span style="font-weight: 700;">40%</span>
                            </div>
                            <div class="region-bar">
                                <span style="width: 50px;">South</span>
                                <div class="progress-bg"><div class="progress-fill" style="width: 15%; background: var(--success);"></div></div>
                                <span style="font-weight: 700;">15%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Users Network -->
            <div id="d-tab-users" class="d-tab-content">
                <div class="live-feed-card" style="height: 100%;">
                    <h3>User Network Analysis</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Database of flagged and monitored entities.</p>
                    <div class="table-header">
                        <span>ENTITY NAME</span>
                        <span>ACCOUNT ID</span>
                        <span>RISK TIER</span>
                        <span>STATUS</span>
                    </div>
                    <div class="feed-scroll">
                         <div class="feed-row">
                            <span><ion-icon name="business" style="vertical-align: middle;"></ion-icon> Crypto Hub</span>
                            <span style="font-family: monospace;">#ACC-9912</span>
                            <span style="color: var(--danger); font-weight:700;">Critical</span>
                            <span class="badge badge-risk">Watchlist</span>
                        </div>
                        <div class="feed-row">
                            <span>Rahul Sharma</span>
                            <span style="font-family: monospace;">#ACC-8821</span>
                            <span style="color: var(--text-primary); font-weight:700;">Low</span>
                            <span class="badge badge-safe">Verified</span>
                        </div>
                        <div class="feed-row">
                            <span>Bot_Network_01</span>
                            <span style="font-family: monospace;">#ACC-0000</span>
                            <span style="color: var(--danger); font-weight:700;">High</span>
                            <span class="badge badge-risk">Blocked</span>
                        </div>
                         <div class="feed-row">
                            <span>Anita Roy</span>
                            <span style="font-family: monospace;">#ACC-1234</span>
                            <span style="color: var(--text-primary); font-weight:700;">Low</span>
                            <span class="badge badge-safe">Verified</span>
                        </div>
                    </div>
                </div>
            </div>

             <!-- Tab 3: Security Rules -->
             <div id="d-tab-rules" class="d-tab-content">
                <div class="live-feed-card" style="height: 100%;">
                    <h3>Detection Rules Configuration</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Active algorithms monitoring payment integrity.</p>
                    
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div class="card" style="display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee;">
                            <div>
                                <h4>Velocity Check (High Frequency)</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Flags >5 transactions in 1 hour from same device.</p>
                            </div>
                            <span class="badge badge-safe">Active</span>
                        </div>

                        <div class="card" style="display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee;">
                            <div>
                                <h4>Geo-Fencing Anomaly</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Flags logins from distances >500km within 10 mins.</p>
                            </div>
                            <span class="badge badge-safe">Active</span>
                        </div>

                        <div class="card" style="display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee;">
                            <div>
                                <h4>Large Amount Threshold</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Flags any single transaction > ₹1,00,000.</p>
                            </div>
                            <span class="badge badge-warning">Testing</span>
                        </div>

                        <div class="card" style="display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee;">
                            <div>
                                <h4>Blacklist Cross-Reference</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Checks receiver against global sanctions list.</p>
                            </div>
                            <span class="badge badge-safe">Active</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Admin Inspection Modal (Existing) -->
        <div id="admin-modal" class="admin-modal-overlay" onclick="closeAdminModal(event)">
            <div class="detail-box">
                <h3 style="margin-bottom: 20px;">Transaction Details</h3>
                <div class="detail-row"><span class="detail-label">ID</span><span class="detail-val" id="modal-id">#TXN-8821</span></div>
                <div class="detail-row"><span class="detail-label">Time</span><span class="detail-val">10:42:05 AM</span></div>
                <div class="detail-row"><span class="detail-label">Sender</span><span class="detail-val">Rahul S.</span></div>
                <div class="detail-row"><span class="detail-label">Receiver</span><span class="detail-val">Crypto Hub</span></div>
                <div class="detail-row"><span class="detail-label">Amount</span><span class="detail-val" id="modal-amt">₹ 50,000</span></div>
                <div class="detail-row"><span class="detail-label">Device</span><span class="detail-val">Android 13 / Pixel</span></div>
                <div class="detail-row"><span class="detail-label">Status</span><span class="badge badge-risk">High Risk</span></div>
                <div style="margin-top: 20px; padding: 10px; background: #f8f9fc; border-radius: 8px; font-size: 0.8rem; color: var(--text-secondary);">
                    <strong>Risk Logic:</strong> Velocity check failed. Sender has made 5 high-value transfers in 1 hour.
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="closeAdminModal(null)">Close Inspection</button>
            </div>
        </div>

        <!-- Admin Profile Modal (NEW) -->
        <div id="admin-profile-modal" class="admin-modal-overlay" onclick="closeAdminProfile(event)">
            <div class="detail-box" style="text-align: center;">
                <div style="width: 80px; height: 80px; border-radius: 50%; background-image: url('https://i.pravatar.cc/150?img=68'); background-size: cover; margin: 0 auto 15px; border: 3px solid var(--accent-orange);"></div>
                <h2 style="margin-bottom: 5px;">System Administrator</h2>
                <span class="badge badge-safe">Super Admin</span>
                
                <div style="margin-top: 20px; text-align: left;">
                    <div class="detail-row"><span class="detail-label">Prism ID</span><span class="detail-val">#ADM-001</span></div>
                    <div class="detail-row"><span class="detail-label">Email</span><span class="detail-val">admin@prism.com</span></div>
                    <div class="detail-row"><span class="detail-label">Department</span><span class="detail-val">Security Ops</span></div>
                    <div class="detail-row"><span class="detail-label">Clearance</span><span class="detail-val">Level 5</span></div>
                    <div class="detail-row" style="border-bottom: none;"><span class="detail-label">Last Login</span><span class="detail-val">Today, 09:15 AM</span></div>
                </div>

                <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="closeAdminProfile(null)">Close Profile</button>
            </div>
        </div>
    </section>

    <script>
        // ==========================
        // SHARED STATE
        // ==========================
        const state = {
            role: null, // 'user' or 'admin'
            balance: 24500,
            payee: null,
            contacts: [
                { id: 1, name: "Anita Roy", phone: "+91 98765 43210", img: "44" },
                { id: 2, name: "Grocery Store", phone: "+91 88888 22222", img: "33" },
                { id: 3, name: "Ravi Kumar", phone: "+91 77777 11111", img: "11" },
                { id: 4, name: "Gym Fees", phone: "+91 66666 00000", img: "55" },
                { id: 5, name: "Crypto Hub", phone: "Unknown", img: "60" } // Risky payee
            ],
            recents: [1, 2, 3],
            history: [
                { title: "Gym Fees", date: "Today, 10:00 AM", amount: "- ₹ 1,500", type: "debit" },
                { title: "Salary", date: "Yesterday", amount: "+ ₹ 45,000", type: "credit" },
                { title: "Grocery Store", date: "2 Oct 2023", amount: "- ₹ 2,340", type: "debit" }
            ],
            transactions: [] // For Admin feed
        };

        // ==========================
        // 1. AUTH LOGIC
        // ==========================
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('emailInput').value;
            
            // Switch Views based on email
            document.getElementById('auth-view').classList.remove('active');
            
            if (email === 'admin@prism.com') {
                state.role = 'admin';
                document.getElementById('desktop-view').classList.add('active');
                initAdminDashboard();
            } else {
                state.role = 'user';
                document.getElementById('mobile-view').classList.add('active');
                initMobileApp();
            }
        }

        function handleLogout() {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('auth-view').classList.add('active');
            const passField = document.querySelector('input[type="password"]');
            if(passField) passField.value = '';
            state.role = null;
            // Reset Tabs
            switchDesktopTab('d-tab-analytics');
            switchMobileContent('m-home');
        }

        // ==========================
        // 2. MOBILE APP LOGIC
        // ==========================
        function initMobileApp() {
            renderContacts();
            renderRecents();
            renderHistory();
            updateBalanceUI();
        }

        // --- View Switching Logic ---
        function switchMobileContent(viewId) {
            document.querySelectorAll('.m-content').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        function updateBalanceUI() {
            document.getElementById('wallet-balance').innerText = `₹ ${state.balance.toLocaleString()}`;
            document.getElementById('bal-hint').innerText = `Available: ₹ ${state.balance.toLocaleString()}`;
        }

        function renderContacts() {
            const list = document.getElementById('contact-list');
            const sendList = document.getElementById('send-contact-list');
            const html = state.contacts.map(c => `
                <div class="contact-row" onclick="startPayment('${c.name}')" data-tooltip="Tap to Pay">
                    <div class="avatar" style="background-image: url('https://i.pravatar.cc/150?img=${c.img}')"></div>
                    <div class="contact-info">
                        <h4>${c.name}</h4>
                        <p>${c.phone}</p>
                    </div>
                </div>
            `).join('');
            
            list.innerHTML = html;
            if(sendList) sendList.innerHTML = html;
        }

        function renderRecents() {
            const list = document.getElementById('recent-list');
            const recentContacts = state.contacts.filter(c => state.recents.includes(c.id));
            list.innerHTML = recentContacts.map(c => `
                <div class="recent-item" onclick="startPayment('${c.name}')" data-tooltip="Quick Pay">
                    <div class="avatar" style="background-image: url('https://i.pravatar.cc/150?img=${c.img}')"></div>
                    <span style="font-size: 0.75rem;">${c.name.split(' ')[0]}</span>
                </div>
            `).join('');
        }

        function renderHistory() {
             const list = document.getElementById('m-hist-list');
             list.innerHTML = state.history.map(h => `
                <div class="contact-row" style="justify-content: space-between;">
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <div style="width: 40px; height: 40px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                             <ion-icon name="${h.type === 'credit' ? 'arrow-down' : 'arrow-up'}"></ion-icon>
                        </div>
                        <div>
                            <h4>${h.title}</h4>
                            <p>${h.date}</p>
                        </div>
                    </div>
                    <div style="font-weight: 700; color: ${h.type === 'credit' ? 'var(--success)' : 'var(--text-primary)'};">${h.amount}</div>
                </div>
             `).join('');
        }

        function startPayment(name) {
            state.payee = name;
            document.getElementById('payee-name').innerText = name;
            document.getElementById('amount-input').value = '';
            document.getElementById('payment-overlay').classList.add('active');
        }
        
        function checkBalance() {
            const amt = parseInt(document.getElementById('amount-input').value) || 0;
            const hint = document.getElementById('bal-hint');
            if (amt > state.balance) {
                hint.style.color = 'var(--danger)';
                hint.innerText = `Insufficient funds (Available: ₹${state.balance.toLocaleString()})`;
            } else {
                hint.style.color = 'var(--text-secondary)';
                hint.innerText = `Available: ₹${state.balance.toLocaleString()}`;
            }
        }

        function simulateScan() {
            switchMobileContent('m-home');
            startPayment("Scanned Merchant");
        }

        function closePayment() {
            document.getElementById('payment-overlay').classList.remove('active');
            document.getElementById('risk-modal').classList.remove('show');
            document.getElementById('balance-error-modal').classList.remove('show');
            document.getElementById('success-screen').classList.remove('active');
        }

        // Profile Modal Logic
        function openProfileModal() {
            document.getElementById('profile-modal').classList.add('show');
        }

        function closeProfileModal() {
            document.getElementById('profile-modal').classList.remove('show');
        }

        function processPayment() {
            const amt = parseInt(document.getElementById('amount-input').value);
            if (!amt || amt <= 0) return alert("Please enter valid amount");
            
            // BALANCE CHECK LOGIC
            if (amt > state.balance) {
                document.getElementById('balance-error-modal').classList.add('show');
                return;
            }

            // --- RISK ENGINE (SIMULATED) ---
            const isRisky = amt > 10000 || state.payee.includes('Crypto');

            if (isRisky) {
                document.getElementById('risk-modal').classList.add('show');
            } else {
                executeTransaction(amt);
            }
        }

        function confirmPay() {
            const amt = parseInt(document.getElementById('amount-input').value);
            document.getElementById('risk-modal').classList.remove('show');
            executeTransaction(amt);
        }

        function executeTransaction(amt) {
            state.balance -= amt;
            updateBalanceUI();
            
            // Add to history
            state.history.unshift({
                title: state.payee,
                date: "Just now",
                amount: `- ₹ ${amt.toLocaleString()}`,
                type: "debit"
            });
            renderHistory();

            document.getElementById('success-amount').innerText = `₹ ${amt.toLocaleString()}`;
            document.getElementById('success-tid').innerText = `#TXN-${Math.floor(Math.random()*90000)+10000}`;
            document.getElementById('success-screen').classList.add('active');

            setTimeout(() => {
                closePayment();
                switchMobileContent('m-home'); // Return to home
            }, 2500);
        }

        // ==========================
        // 3. ADMIN DASHBOARD LOGIC
        // ==========================
        function initAdminDashboard() {
            // Populate Dummy Live Feed
            const feed = document.getElementById('admin-feed');
            const dummyData = [
                { id: "#TXN-9982", from: "Anita Roy", to: "Shopping Mall", amt: 2400, risk: "Safe" },
                { id: "#TXN-9983", from: "Rahul S.", to: "Crypto Hub", amt: 50000, risk: "High" },
                { id: "#TXN-9984", from: "John Doe", to: "Coffee Shop", amt: 150, risk: "Safe" },
                { id: "#TXN-9985", from: "Rahul S.", to: "Unknown User", amt: 12000, risk: "Medium" },
                { id: "#TXN-9986", from: "Priya K.", to: "Ravi Kumar", amt: 500, risk: "Safe" },
                { id: "#TXN-9987", from: "System", to: "Maintenance", amt: 0, risk: "Safe" },
                { id: "#TXN-9988", from: "Bot_01", to: "Server A", amt: 99999, risk: "High" },
            ];

            feed.innerHTML = dummyData.map(t => {
                const badgeClass = t.risk === 'High' ? 'badge-risk' : (t.risk === 'Medium' ? 'badge-warning' : 'badge-safe');
                return `
                <div class="feed-row" onclick="openAdminModal('${t.id}', '${t.amt}', '${t.risk}')" data-tooltip="Inspect Transaction">
                    <span style="font-family: monospace;">${t.id}</span>
                    <span>${t.from} &rarr; ${t.to}</span>
                    <span style="font-weight: 600;">₹ ${t.amt.toLocaleString()}</span>
                    <span><span class="badge ${badgeClass}">${t.risk} Risk</span></span>
                </div>
                `;
            }).join('');
        }

        // --- Desktop Tab Switching ---
        function switchDesktopTab(tabId) {
            document.querySelectorAll('.d-tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            // Update Sidebar Active State
            document.querySelectorAll('.nav-icon').forEach(el => el.classList.remove('active'));
            if(tabId === 'd-tab-analytics') document.getElementById('nav-analytics').classList.add('active');
            if(tabId === 'd-tab-users') document.getElementById('nav-users').classList.add('active');
            if(tabId === 'd-tab-rules') document.getElementById('nav-rules').classList.add('active');
        }

        function openAdminModal(id, amt, risk) {
            document.getElementById('modal-id').innerText = id;
            document.getElementById('modal-amt').innerText = `₹ ${parseInt(amt).toLocaleString()}`;
            document.getElementById('admin-modal').classList.add('active');
        }

        function closeAdminModal(e) {
            if (e && e.target !== e.currentTarget) return; // Allow closing only on overlay click or button
            document.getElementById('admin-modal').classList.remove('active');
        }
        
        // --- Admin Profile Logic ---
        function openAdminProfile() {
            document.getElementById('admin-profile-modal').classList.add('active');
        }

        function closeAdminProfile(e) {
            if (e && e.target !== e.currentTarget) return; // Allow closing only on overlay click or button
            document.getElementById('admin-profile-modal').classList.remove('active');
        }

    </script>
</body>
</html>